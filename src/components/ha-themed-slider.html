<link rel='import' href='../../bower_components/polymer/polymer.html'>
<link rel='import' href='../../bower_components/paper-slider/paper-slider.html'>

<dom-module id='ha-themed-slider'>
  <template>
    <style>
      .disable-off-when-min ::content .pin.ring.paper-slider > #sliderKnob.paper-slider > #sliderKnobInner.paper-slider::before {
        background-color: var(--paper-slider-pin-color);
      }
      .disable-off-when-min.is-on ::content .ring.paper-slider > #sliderKnob.paper-slider > #sliderKnobInner.paper-slider,
      .disable-off-when-min ::content .ring.expand.paper-slider > #sliderKnob.paper-slider > #sliderKnobInner.paper-slider {
        background-color: var(--paper-slider-knob-color);
        border-color: var(--paper-slider-knob-color);
      }
    </style>

    <paper-slider
         min='[[_computeAttribute(theme, "min", min)]]'
         max='[[_computeAttribute(theme, "max", max)]]'
         pin='[[_computeAttribute(theme, "pin", pin)]]'
         class$='[[computeClass(theme, isOn)]]' value='{{value}}'
         on-change='valueChanged'>
    </paper-slider>
  </template>
</dom-module>

<script>
Polymer({
  is: 'ha-themed-slider',

  ready: function () {
    this._savedValue = this.value;
    // Update the themed value upwards.
    this.disableOffWhenMin = !this._computeAttribute(this.theme, 'off_when_min', !this.disableOffWhenMin);
  },

  properties: {
    min: {
      type: Number,
      value: 0,
    },

    max: {
      type: Number,
      value: 100,
    },

    pin: {
      type: Boolean,
      value: false,
    },

    isOn: {
      type: Boolean,
      value: false,
    },

    disableOffWhenMin: {
      type: Boolean,
      value: false,
      notify: true,
    },

    disableReportWhenNotChanged: {
      type: Boolean,
      value: false,
    },

    theme: {
      type: Object,
    },

    value: {
      type: Number,
      notify: true,
    },
  },

  _computeAttribute: function (theme, attr, def) {
    if (theme) {
      if (attr in theme) {
        return theme[attr];
      }
    }
    return def;
  },

  computeClass: function (theme, isOn) {
    var result = '';
    if (isOn) {
      result += 'is-on ';
    }

    if (this._computeAttribute(theme, 'off_when_min', !this.disableOffWhenMin)) {
      // If offWhenMin is enabled don't customize.
      return '';
    }
    return result + 'disable-off-when-min';
  },

  valueChanged: function (ev) {
    if (!this._computeAttribute(
        this.theme, 'report_when_not_changed', !this.disableReportWhenNotChanged) && this.value === this._savedValue) {
      ev.stopPropagation();
    }
    this._savedValue = this.value;
  },

});
</script>


